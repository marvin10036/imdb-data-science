graph TB
    %% ========================================
    %% FLUXO DE DADOS: Views e AgregaÃ§Ãµes
    %% Data Pipeline Architecture
    %% ========================================
    
    subgraph RAW["ğŸ“¦ CAMADA RAW (Tabelas Fonte)"]
        movies["ğŸ¬ MOVIES<br/>Dados principais<br/>(3,181 filmes)"]
        box_office["ğŸ’° MOVIE_BOX_OFFICE<br/>Budget & Gross<br/>(1:1 com movies)"]
        rating_samples["â­ RATING_SAMPLES<br/>Scores Metacritic<br/>(amostras individuais)"]
        genres["ğŸ­ GENRES<br/>GÃªneros<br/>(22 categorias)"]
        people["ğŸ‘¥ PEOPLE<br/>Pessoas<br/>(10,758 registros)"]
        countries["ğŸŒ COUNTRIES<br/>PaÃ­ses<br/>(88 paÃ­ses)"]
        languages["ğŸ—£ï¸ LANGUAGES<br/>Idiomas<br/>(132 idiomas)"]
        
        %% Tabelas de relacionamento N:N
        movie_genres["MOVIE_GENRES<br/>(8,560 relaÃ§Ãµes)"]
        movie_people["MOVIE_PEOPLE<br/>(27,290 relaÃ§Ãµes)"]
        movie_countries["MOVIE_COUNTRIES<br/>(6,469 relaÃ§Ãµes)"]
        movie_languages["MOVIE_LANGUAGES<br/>(6,151 relaÃ§Ãµes)"]
    end
    
    subgraph AGG["ğŸ”„ CAMADA AGREGADA (Views IntermediÃ¡rias)"]
        rating_stats["ğŸ“Š MOVIE_RATING_STATS<br/><b>View de AgregaÃ§Ã£o</b><br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ n_samples<br/>â€¢ mean_score<br/>â€¢ median_score<br/>â€¢ stddev_score<br/>â€¢ p90_score<br/>â€¢ min/max_score<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>(AgregaÃ§Ã£o por filme)"]
    end
    
    subgraph ML["ğŸ¤– CAMADA ML (Dataset Final)"]
        ml_dataset["ğŸ¯ ML_TRAINING_DATASET<br/><b>View Principal de ML</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/><b>FEATURES BÃSICAS (10):</b><br/>â€¢ imdb_id, title, year<br/>â€¢ imdb_rating, imdb_votes<br/>â€¢ runtime_minutes<br/>â€¢ metascore<br/>â€¢ budget, worldwide_gross<br/>â€¢ domestic_gross<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>FEATURES DERIVADAS (5):</b><br/>â€¢ roi_worldwide<br/>â€¢ us_market_share<br/>â€¢ box_office_rank_in_year<br/>â€¢ votes_normalized_by_year<br/>â€¢ rating_normalized_by_year<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>STATS METACRITIC (7):</b><br/>â€¢ n_samples, mean_score<br/>â€¢ median_score, stddev_score<br/>â€¢ p90_score, min/max_score<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>CONTAGENS (6):</b><br/>â€¢ num_genres<br/>â€¢ num_countries<br/>â€¢ num_languages<br/>â€¢ num_directors<br/>â€¢ num_writers<br/>â€¢ num_cast<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>LABEL (1):</b><br/>â€¢ label (0=nÃ£o indicado, 1=indicado)<br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/><b>TOTAL: 29 colunas</b>"]
    end
    
    subgraph OUTPUT["ğŸ“¤ SAÃDA (Consumo)"]
        python["ğŸ Python/Pandas<br/>Notebooks de ML<br/>load_ml_dataset()"]
        export["ğŸ’¾ CSV Export<br/>data/processed/<br/>final_dataset.csv"]
    end
    
    %% ========================================
    %% FLUXO DE DADOS (DependÃªncias)
    %% ========================================
    
    %% RAW â†’ AGG
    movies --> rating_stats
    rating_samples --> rating_stats
    
    %% RAW â†’ ML
    movies --> ml_dataset
    box_office --> ml_dataset
    rating_stats --> ml_dataset
    
    %% Subqueries de contagem
    movie_genres -.->|"COUNT(*)"| ml_dataset
    movie_countries -.->|"COUNT(*)"| ml_dataset
    movie_languages -.->|"COUNT(*)"| ml_dataset
    movie_people -.->|"COUNT(*)<br/>por role"| ml_dataset
    
    %% ML â†’ OUTPUT
    ml_dataset --> python
    ml_dataset --> export
    
    %% ========================================
    %% LEGENDAS
    %% ========================================
    
    classDef rawTable fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef aggView fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef mlView fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    classDef output fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class movies,box_office,rating_samples,genres,people,countries,languages,movie_genres,movie_people,movie_countries,movie_languages rawTable
    class rating_stats aggView
    class ml_dataset mlView
    class python,export output
