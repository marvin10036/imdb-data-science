graph LR
    %% ========================================
    %% ARQUITETURA ML: Feature Engineering Pipeline
    %% ========================================
    
    subgraph INPUT["ğŸ“¥ INPUT LAYER"]
        raw_movies["ğŸ¬ Movies<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ imdb_rating<br/>â€¢ imdb_votes<br/>â€¢ release_year"]
        raw_box["ğŸ’° Box Office<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ budget<br/>â€¢ worldwide_gross<br/>â€¢ domestic_gross"]
    end
    
    subgraph FEATURES["âš™ï¸ FEATURE ENGINEERING"]
        direction TB
        
        basic["<b>BASIC FEATURES</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>Direto das tabelas<br/>sem transformaÃ§Ã£o"]
        
        derived["<b>DERIVED FEATURES</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/><b>1. ROI</b><br/>worldwide_gross / budget<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>2. US Market Share</b><br/>domestic_gross / worldwide_gross<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>3. Box Office Rank</b><br/>RANK() OVER (PARTITION BY year)<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>4. Votes Z-Score</b><br/>(votes - Î¼_year) / Ïƒ_year<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/><b>5. Rating Z-Score</b><br/>(rating - Î¼_year) / Ïƒ_year"]
        
        aggregated["<b>AGGREGATED FEATURES</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>EstatÃ­sticas Metacritic:<br/>â€¢ mean_score<br/>â€¢ median_score<br/>â€¢ stddev_score<br/>â€¢ p90_score"]
        
        counts["<b>COUNT FEATURES</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>â€¢ num_genres<br/>â€¢ num_countries<br/>â€¢ num_languages<br/>â€¢ num_directors<br/>â€¢ num_writers<br/>â€¢ num_cast"]
    end
    
    subgraph NORMALIZATION["ğŸ”„ NORMALIZATION"]
        window["<b>WINDOW FUNCTIONS</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>PARTITION BY release_year<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>â€¢ AVG()<br/>â€¢ STDDEV()<br/>â€¢ RANK()"]
    end
    
    subgraph OUTPUT["ğŸ“Š OUTPUT"]
        ml_ready["<b>ML_TRAINING_DATASET</b><br/>â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•<br/>29 Features + 1 Label<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>âœ… Pronto para ML<br/>âœ… Normalizado<br/>âœ… Features derivadas<br/>âœ… Sem duplicaÃ§Ã£o"]
    end
    
    subgraph TARGET["ğŸ¯ TARGET VARIABLE"]
        label["<b>LABEL</b><br/>â•â•â•â•â•â•â•â•<br/>nominated_oscar::INT<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>0 = NÃ£o indicado<br/>1 = Indicado<br/>â”€â”€â”€â”€â”€â”€â”€â”€<br/>Desbalanceado:<br/>186 indicados (5.8%)<br/>2,995 nÃ£o (94.2%)"]
    end
    
    %% ========================================
    %% FLUXO
    %% ========================================
    
    raw_movies --> basic
    raw_box --> basic
    
    raw_movies --> derived
    raw_box --> derived
    
    raw_movies --> window
    window --> derived
    
    basic --> ml_ready
    derived --> ml_ready
    aggregated --> ml_ready
    counts --> ml_ready
    
    ml_ready --> label
    
    %% ========================================
    %% ESTILOS
    %% ========================================
    
    classDef inputClass fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef featureClass fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef normalClass fill:#e1f5fe,stroke:#0288d1,stroke-width:2px
    classDef outputClass fill:#e8f5e9,stroke:#388e3c,stroke-width:3px
    classDef targetClass fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class raw_movies,raw_box inputClass
    class basic,derived,aggregated,counts featureClass
    class window normalClass
    class ml_ready outputClass
    class label targetClass
